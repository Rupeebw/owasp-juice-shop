================================================================================
SECURITY SCAN TOOLS IN OWASP JUICE SHOP REPOSITORY
DevSecOps Pipeline Security Tooling Reference
================================================================================

TL;DR
=====
This repository references 11+ security scanning tools with TWO DEPLOYMENT PATHS:

COMMON STAGES (Both Paths):
- TEST STAGE: SAST, Secret Detection, Unit Tests
- SECURITY-SCAN STAGE: npm audit, TrivyðŸ³, OPA/ConftestðŸ³, Gitleaks, RetireJS (parallel)
- SONAR: Code quality and security analysis (manual gate)
- DOCKER BUILD: Multi-stage container build

PATH 1 - KUBERNETES (Primary Training):
- K8S DEPLOY: Local Kind cluster deployment (port 30080)
- K8S-SECURITY: DAST (ZAP, Security Headers) + K8s Cluster Scans (reference)
- Tools: KubeSec, KubeBench, KubeScan, Falco

PATH 2 - AWS ECS (Cloud Alternative):
- ECS DEPLOY: AWS Fargate + ECR push
- ECS-SECURITY: DAST (ZAP, Security Headers) + AWS Security Scans (reference)
- Tools: ECR Scan, ECS Task Check, GuardDuty

Total: 11 main tools + 4 K8s tools + 3 ECS tools = 18 security tools
Docker Focus: Trivy (#5) and OPA/Conftest (#6) marked with ðŸ³
Focus: Dev/Training environment with dual deployment options

================================================================================
SECURITY TOOLS INVENTORY (11 TOOLS - DEV/TRAINING FOCUS)
================================================================================

STATUS LEGEND:
âœ… Currently Implemented - Active in current pipeline
ðŸ“‹ Documented/Planned - Documented in training materials, not yet implemented
ðŸ”® Reference Only - From DevSecOps reference material, not planned for Juice Shop

â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ #  â”‚ Tool Name           â”‚ Category     â”‚ Pipeline Stage â”‚ Status          â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ SAST (Generic)      â”‚ SAST         â”‚ TEST           â”‚ ðŸ“‹ Planned      â”‚
â”‚ 2  â”‚ Secret Detection    â”‚ Secret Scan  â”‚ TEST           â”‚ ðŸ“‹ Planned      â”‚
â”‚ 3  â”‚ Unit Tests          â”‚ Testing      â”‚ TEST           â”‚ âœ… Implemented  â”‚
â”‚ 4  â”‚ npm audit           â”‚ SCA          â”‚ SECURITY-SCAN  â”‚ ðŸ“‹ Planned      â”‚
â”‚ 5  â”‚ Trivy               â”‚ Container    â”‚ SECURITY-SCAN  â”‚ ðŸ“‹ Planned      â”‚
â”‚ 6  â”‚ OPA/Conftest        â”‚ Policy       â”‚ SECURITY-SCAN  â”‚ ðŸ“‹ Planned      â”‚
â”‚ 7  â”‚ Gitleaks            â”‚ Secret Scan  â”‚ SECURITY-SCAN  â”‚ ðŸ“‹ Planned      â”‚
â”‚ 8  â”‚ RetireJS            â”‚ SCA          â”‚ SECURITY-SCAN  â”‚ ðŸ“‹ Planned      â”‚
â”‚ 9  â”‚ SonarQube           â”‚ SAST         â”‚ SONAR          â”‚ ðŸ“‹ Planned      â”‚
â”‚ 10 â”‚ OWASP ZAP (Staging) â”‚ DAST         â”‚ STAGING-SEC    â”‚ ðŸ“‹ Planned      â”‚
â”‚ 11 â”‚ Security Headers    â”‚ Security     â”‚ STAGING-SEC    â”‚ ðŸ“‹ Planned      â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KUBERNETES SECURITY TOOLS (PATH 1 - K8s Deployment):
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12 â”‚ KubeSec             â”‚ K8s Security â”‚ K8s Deploy     â”‚ ðŸ”® Reference    â”‚
â”‚ 13 â”‚ KubeBench           â”‚ K8s Security â”‚ K8s Runtime    â”‚ ðŸ”® Reference    â”‚
â”‚ 14 â”‚ KubeScan            â”‚ K8s Security â”‚ K8s Runtime    â”‚ ðŸ”® Reference    â”‚
â”‚ 15 â”‚ Falco               â”‚ Runtime Sec  â”‚ K8s Runtime    â”‚ ðŸ”® Reference    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AWS ECS SECURITY TOOLS (PATH 2 - ECS Deployment):
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 16 â”‚ ECR Image Scan      â”‚ Container    â”‚ ECS Security   â”‚ ðŸ”® Reference    â”‚
â”‚ 17 â”‚ ECS Task Check      â”‚ ECS Config   â”‚ ECS Security   â”‚ ðŸ”® Reference    â”‚
â”‚ 18 â”‚ AWS GuardDuty       â”‚ Threat Det   â”‚ ECS Security   â”‚ ðŸ”® Reference    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GITLAB AUTO-DEVOPS (in .gitlab-ci.yml):
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 19 â”‚ GitLab SAST         â”‚ SAST         â”‚ Auto-DevOps    â”‚ âœ… Configured   â”‚
â”‚ 20 â”‚ GitLab DAST         â”‚ DAST         â”‚ Auto-DevOps    â”‚ âœ… Disabled     â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
PIPELINE FLOW DIAGRAM - SECURITY TOOLS IN CONTEXT
================================================================================

TWO DEPLOYMENT PATHS: Kubernetes (K8s) and AWS ECS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PATH 1: KUBERNETES (K8s) DEPLOYMENT FLOW - Primary Training Path
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

 BUILD         SETUP/        TEST STAGE      SECURITY-SCAN         SONAR        DOCKER         K8S            K8S-           K8S-SECURITY
ARTIFACT  â”€â”€â–º   LINT   â”€â”€â–º   (Blocking)  â”€â”€â–º (Parallel Scans)  â”€â”€â–º (Manual) â”€â”€â–º BUILD+PUSH â”€â”€â–º DEPLOY   â”€â”€â–º  SECURITY  â”€â”€â–º  (K8s Scans)
   âœ“            âœ“              ðŸ”´              âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸            ðŸ”’         ðŸ³ DOCKER ðŸ³    âœ“            (DAST)          ðŸ”®ðŸ”®ðŸ”®ðŸ”®
                                              ðŸ³ DOCKER FOCUS                                                âš ï¸âš ï¸

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  npm    â”‚  â”‚  npm   â”‚   â”‚            â”‚   â”‚ Vulnerabilityâ”‚   â”‚   9.   â”‚  â”‚ Docker â”‚   â”‚ K8s    â”‚   â”‚          â”‚   â”‚    K8s   â”‚
â”‚ install â”‚â”€â–ºâ”‚  run   â”‚â”€â–º â”‚  1. SAST   â”‚â”€â–º â”‚  & Docker    â”‚â”€â–º â”‚ Sonar  â”‚â”€â–ºâ”‚  Build â”‚â”€â–º â”‚ Clusterâ”‚â”€â–º â”‚ 10. ZAP  â”‚â”€â–º â”‚  Cluster â”‚
â”‚         â”‚  â”‚  lint  â”‚   â”‚  [BLOCK]   â”‚   â”‚    Scans     â”‚   â”‚  Qube  â”‚  â”‚   &    â”‚   â”‚ Deploy â”‚   â”‚ Baseline â”‚   â”‚ Security â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚            â”‚   â”‚              â”‚   â”‚ [GATE] â”‚  â”‚  Tag   â”‚   â”‚  to    â”‚   â”‚ [WARN]   â”‚   â”‚ [REF]    â”‚
                          â”‚  2. Secret â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚        â”‚  â”‚        â”‚   â”‚ Kind   â”‚   â”‚          â”‚   â”‚          â”‚
                          â”‚  Detection â”‚   â”‚  â”‚4. npm  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚:30080  â”‚   â”‚ 11. Sec  â”‚   â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
                          â”‚  [BLOCK]   â”‚   â”‚  â”‚ audit  â”‚  â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ Headers  â”‚   â”‚â”‚12.Kube â”‚â”‚â”‚
                          â”‚            â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                          â”‚ [WARN]   â”‚   â”‚â”‚  Sec   â”‚â”‚â”‚
                          â”‚  3. Unit   â”‚   â”‚              â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚ [REF]  â”‚â”‚â”‚
                          â”‚   Tests    â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                          â”‚  [WARN]    â”‚   â”‚  â”‚5.Trivy â”‚  â”‚                                                         â”‚          â”‚
                          â”‚            â”‚   â”‚  â”‚ DOCKER â”‚  â”‚                                                         â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ðŸ³[WARN]â”‚  â”‚                                                         â”‚â”‚13.Kube â”‚â”‚â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                         â”‚â”‚ Bench  â”‚â”‚â”‚
                                          â”‚              â”‚                                                         â”‚â”‚ [REF]  â”‚â”‚â”‚
                                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                                          â”‚  â”‚6. OPA/ â”‚  â”‚                                                         â”‚          â”‚
                                          â”‚  â”‚Conftestâ”‚  â”‚                                                         â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
                                          â”‚  â”‚DOCKER  â”‚  â”‚                                                         â”‚â”‚14.Kube â”‚â”‚â”‚
                                          â”‚  â”‚ðŸ³[WARN]â”‚  â”‚                                                         â”‚â”‚  Scan  â”‚â”‚â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                         â”‚â”‚ [REF]  â”‚â”‚â”‚
                                          â”‚              â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                         â”‚          â”‚
                                          â”‚  â”‚7.Gitleaksâ”‚ â”‚                                                         â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
                                          â”‚  â”‚ [WARN] â”‚  â”‚                                                         â”‚â”‚15.Falcoâ”‚â”‚â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                         â”‚â”‚ [REF]  â”‚â”‚â”‚
                                          â”‚              â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚  â”‚8.RetireJSâ”‚ â”‚
                                          â”‚  â”‚ [WARN] â”‚  â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PATH 2: AWS ECS DEPLOYMENT FLOW - Cloud-Native Alternative
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

 BUILD         SETUP/        TEST STAGE      SECURITY-SCAN         SONAR        DOCKER         ECS            ECS-           ECS-SECURITY
ARTIFACT  â”€â”€â–º   LINT   â”€â”€â–º   (Blocking)  â”€â”€â–º (Parallel Scans)  â”€â”€â–º (Manual) â”€â”€â–º BUILD+PUSH â”€â”€â–º DEPLOY   â”€â”€â–º  SECURITY  â”€â”€â–º  (ECS Scans)
   âœ“            âœ“              ðŸ”´              âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸            ðŸ”’         ðŸ³ DOCKER ðŸ³    â˜ï¸            (DAST)          ðŸ”®ðŸ”®ðŸ”®
                                              ðŸ³ DOCKER FOCUS                                                âš ï¸âš ï¸

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  npm    â”‚  â”‚  npm   â”‚   â”‚            â”‚   â”‚ Vulnerabilityâ”‚   â”‚   9.   â”‚  â”‚ Docker â”‚   â”‚  ECS   â”‚   â”‚          â”‚   â”‚   ECS    â”‚
â”‚ install â”‚â”€â–ºâ”‚  run   â”‚â”€â–º â”‚  1. SAST   â”‚â”€â–º â”‚  & Docker    â”‚â”€â–º â”‚ Sonar  â”‚â”€â–ºâ”‚  Build â”‚â”€â–º â”‚ Fargateâ”‚â”€â–º â”‚ 10. ZAP  â”‚â”€â–º â”‚ Security â”‚
â”‚         â”‚  â”‚  lint  â”‚   â”‚  [BLOCK]   â”‚   â”‚    Scans     â”‚   â”‚  Qube  â”‚  â”‚   &    â”‚   â”‚ Deploy â”‚   â”‚ Baseline â”‚   â”‚   Scan   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚            â”‚   â”‚              â”‚   â”‚ [GATE] â”‚  â”‚  Push  â”‚   â”‚  to    â”‚   â”‚ [WARN]   â”‚   â”‚ [REF]    â”‚
                          â”‚  2. Secret â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚        â”‚  â”‚  to    â”‚   â”‚  AWS   â”‚   â”‚          â”‚   â”‚          â”‚
                          â”‚  Detection â”‚   â”‚  â”‚4. npm  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  ECR   â”‚   â”‚ Cloud  â”‚   â”‚ 11. Sec  â”‚   â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
                          â”‚  [BLOCK]   â”‚   â”‚  â”‚ audit  â”‚  â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ Headers  â”‚   â”‚â”‚16. ECR â”‚â”‚â”‚
                          â”‚            â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                          â”‚ [WARN]   â”‚   â”‚â”‚  Scan  â”‚â”‚â”‚
                          â”‚  3. Unit   â”‚   â”‚              â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚ [REF]  â”‚â”‚â”‚
                          â”‚   Tests    â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                          â”‚  [WARN]    â”‚   â”‚  â”‚5.Trivy â”‚  â”‚                                                         â”‚          â”‚
                          â”‚            â”‚   â”‚  â”‚ DOCKER â”‚  â”‚                                                         â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ðŸ³[WARN]â”‚  â”‚                                                         â”‚â”‚17. ECS â”‚â”‚â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                         â”‚â”‚ Task   â”‚â”‚â”‚
                                          â”‚              â”‚                                                         â”‚â”‚ Check  â”‚â”‚â”‚
                                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                         â”‚â”‚ [REF]  â”‚â”‚â”‚
                                          â”‚  â”‚6. OPA/ â”‚  â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                                          â”‚  â”‚Conftestâ”‚  â”‚                                                         â”‚          â”‚
                                          â”‚  â”‚DOCKER  â”‚  â”‚                                                         â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
                                          â”‚  â”‚ðŸ³[WARN]â”‚  â”‚                                                         â”‚â”‚18.Guardâ”‚â”‚â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                                         â”‚â”‚ Duty   â”‚â”‚â”‚
                                          â”‚              â”‚                                                         â”‚â”‚ [REF]  â”‚â”‚â”‚
                                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                                         â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                                          â”‚  â”‚7.Gitleaksâ”‚ â”‚                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚  â”‚ [WARN] â”‚  â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                          â”‚              â”‚
                                          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                                          â”‚  â”‚8.RetireJSâ”‚ â”‚
                                          â”‚  â”‚ [WARN] â”‚  â”‚
                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STAGE DETAILS (Common Stages):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BUILD ARTIFACT: npm install (dependencies setup)
SETUP/LINT:     Code style validation (eslint, typescript checks)
TEST STAGE:     3 security checks run sequentially (blocking on SAST & Secrets)
SECURITY-SCAN:  5 parallel vulnerability scans (all warnings for training)
                ðŸ³ DOCKER FOCUS: Tools #5 (Trivy) and #6 (OPA/Conftest) scan Docker
SONAR:          Manual code quality gate review
DOCKER BUILD:   Multi-stage build, create container image (same for both paths)

PATH 1: K8s-SPECIFIC STAGES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
K8S DEPLOY:     Deploy to local Kind cluster (port 30080)
K8S-SECURITY:   2 runtime DAST scans (#10 ZAP, #11 Sec Headers)
K8S-SECURITY:   4 Kubernetes cluster scans (#12-15: KubeSec, KubeBench, KubeScan, Falco)

PATH 2: ECS-SPECIFIC STAGES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ECS DEPLOY:     Deploy to AWS ECS Fargate (push to ECR)
ECS-SECURITY:   2 runtime DAST scans (#10 ZAP, #11 Sec Headers)
ECS-SECURITY:   3 AWS-specific scans (#16 ECR Scan, #17 ECS Task Check, #18 GuardDuty)

LEGEND:
â”€â”€â”€â”€â”€â”€â”€
âœ“  = Completed stage
ðŸ”´ = BLOCKING - Pipeline fails if issues found (TEST stage only)
âš ï¸  = WARNING - Pipeline continues, alerts generated (SECURITY-SCAN, STAGING-SEC)
ðŸ”’ = MANUAL - Requires approval to proceed (SONAR gate)
ðŸ”® = REFERENCE - Optional/reference tools (K8S-SECURITY, ECS-SECURITY stages)
ðŸ³ = DOCKER - Docker/container-focused security tool
â˜ï¸  = CLOUD - AWS cloud deployment (ECS path)
[BLOCK] = Blocks deployment on failure
[WARN] = Warns but allows continuation
[GATE] = Manual review checkpoint
[REF] = Reference only - not implemented in training pipeline

================================================================================
DETAILED TOOL DESCRIPTIONS
================================================================================

CATEGORY 1: STATIC APPLICATION SECURITY TESTING (SAST)
-------------------------------------------------------
Purpose: Analyze source code for vulnerabilities without executing it
When: Early in pipeline (left-shift security)
Blocks: Yes (critical issues)

Tool #1: SAST (Generic) - CodeQL or Semgrep
â”œâ”€ Purpose: Scan source code for security vulnerabilities
â”œâ”€ Stage: TEST (Blocking)
â”œâ”€ Technology: CodeQL (recommended) or Semgrep (lightweight alternative)
â”œâ”€ What it scans: TypeScript/JavaScript source code
â”œâ”€ Detects: SQL injection, XSS, hardcoded secrets, insecure functions
â”œâ”€ Exit behavior: BLOCKS pipeline on HIGH/CRITICAL findings
â”œâ”€ Scan time: 3-8 minutes (CodeQL), 1-3 minutes (Semgrep)
â”œâ”€ Implementation: GitHub Actions (planned)
â””â”€ Status: ðŸ“‹ Documented, not yet implemented

Tool #1a: CodeQL (Recommended SAST Implementation)
â”œâ”€ Purpose: Semantic code analysis for security vulnerabilities
â”œâ”€ Developer: GitHub (Microsoft)
â”œâ”€ Category: SAST (Static Application Security Testing)
â”œâ”€ Stage: TEST (Blocking)
â”œâ”€ What it scans:
â”‚   â€¢ JavaScript/TypeScript source code
â”‚   â€¢ Node.js backend code
â”‚   â€¢ Frontend code (Angular, React patterns)
â”‚   â€¢ Configuration files with code logic
â”œâ”€ How it works:
â”‚   â€¢ Treats code as data (builds code database)
â”‚   â€¢ Uses semantic queries (not just pattern matching)
â”‚   â€¢ Understands data flow and control flow
â”‚   â€¢ Tracks tainted data through application
â”œâ”€ Detects:
â”‚   â€¢ SQL Injection (parameterized query violations)
â”‚   â€¢ Cross-Site Scripting (XSS) - reflected, stored, DOM-based
â”‚   â€¢ Path Traversal (directory traversal attacks)
â”‚   â€¢ Command Injection (shell command vulnerabilities)
â”‚   â€¢ Hardcoded Credentials (passwords, API keys in code)
â”‚   â€¢ Insecure Cryptography (weak algorithms, hardcoded keys)
â”‚   â€¢ Authentication Bypass (logic flaws)
â”‚   â€¢ CSRF vulnerabilities
â”‚   â€¢ Prototype Pollution (JavaScript-specific)
â”‚   â€¢ Regular Expression DoS (ReDoS)
â”‚   â€¢ Insecure Deserialization
â”‚   â€¢ XML External Entity (XXE) injection
â”œâ”€ Query Packs:
â”‚   â€¢ security-extended (comprehensive security queries)
â”‚   â€¢ security-and-quality (security + code quality)
â”‚   â€¢ code-scanning (default GitHub scanning)
â”œâ”€ Exit behavior: BLOCKS on HIGH/CRITICAL findings
â”œâ”€ Scan time: 3-8 minutes (depends on codebase size)
â”œâ”€ Output formats:
â”‚   â€¢ SARIF (Static Analysis Results Interchange Format)
â”‚   â€¢ CSV (for reporting)
â”‚   â€¢ GitHub Security tab integration
â”œâ”€ GitHub Actions Integration:
â”‚   uses: github/codeql-action/init@v3
â”‚   with:
â”‚     languages: javascript
â”‚     queries: security-extended
â”œâ”€ Advantages:
â”‚   âœ“ Deep semantic analysis (not just regex)
â”‚   âœ“ Low false-positive rate
â”‚   âœ“ Native GitHub integration
â”‚   âœ“ Excellent JavaScript/TypeScript support
â”‚   âœ“ Free for public repositories
â”‚   âœ“ Tracks data flow across functions
â”‚   âœ“ Understands framework patterns (Express, Angular)
â”œâ”€ Limitations:
â”‚   âœ— Slower than pattern-based tools
â”‚   âœ— Requires compilation/build step
â”‚   âœ— Limited to supported languages
â”œâ”€ Use Cases:
â”‚   â€¢ Production-grade security scanning
â”‚   â€¢ Compliance requirements (SOC2, PCI-DSS)
â”‚   â€¢ Finding complex vulnerabilities
â”‚   â€¢ GitHub-hosted projects
â”œâ”€ Example Findings:
â”‚   â€¢ "Unsanitized user input in SQL query" (SQL Injection)
â”‚   â€¢ "User-controlled data in HTML context" (XSS)
â”‚   â€¢ "Hardcoded credentials in source code"
â”‚   â€¢ "Weak cryptographic algorithm (MD5)"
â””â”€ Status: ðŸ“‹ Recommended for enhanced-pipeline.yml

Tool #1b: Semgrep (Lightweight SAST Alternative)
â”œâ”€ Purpose: Fast pattern-based static analysis
â”œâ”€ Developer: Semgrep (r2c)
â”œâ”€ Category: SAST (Static Application Security Testing)
â”œâ”€ Stage: TEST (Blocking)
â”œâ”€ What it scans:
â”‚   â€¢ JavaScript/TypeScript code
â”‚   â€¢ Node.js applications
â”‚   â€¢ Configuration files (JSON, YAML)
â”‚   â€¢ Infrastructure as Code
â”œâ”€ How it works:
â”‚   â€¢ Pattern-based matching (like grep but code-aware)
â”‚   â€¢ AST (Abstract Syntax Tree) based
â”‚   â€¢ Custom rule engine
â”‚   â€¢ Fast parallel scanning
â”œâ”€ Detects:
â”‚   â€¢ SQL Injection patterns
â”‚   â€¢ XSS vulnerabilities
â”‚   â€¢ Hardcoded secrets (API keys, tokens)
â”‚   â€¢ Insecure function usage
â”‚   â€¢ OWASP Top 10 vulnerabilities
â”‚   â€¢ Custom organizational rules
â”‚   â€¢ Dependency confusion risks
â”‚   â€¢ Insecure configurations
â”œâ”€ Rule Sets:
â”‚   â€¢ p/security-audit (comprehensive security)
â”‚   â€¢ p/owasp-top-ten (OWASP Top 10 coverage)
â”‚   â€¢ p/javascript (JavaScript-specific)
â”‚   â€¢ p/typescript (TypeScript-specific)
â”‚   â€¢ Custom rules (YAML-based)
â”œâ”€ Exit behavior: BLOCKS on ERROR severity
â”œâ”€ Scan time: 1-3 minutes (faster than CodeQL)
â”œâ”€ Output formats:
â”‚   â€¢ JSON (structured results)
â”‚   â€¢ SARIF (GitHub integration)
â”‚   â€¢ Text (human-readable)
â”‚   â€¢ GitLab SAST format
â”œâ”€ GitHub Actions Integration:
â”‚   uses: returntocorp/semgrep-action@v1
â”‚   with:
â”‚     config: p/security-audit
â”œâ”€ Advantages:
â”‚   âœ“ Very fast (2-5x faster than CodeQL)
â”‚   âœ“ Easy custom rule creation
â”‚   âœ“ Multi-language support (30+ languages)
â”‚   âœ“ Low resource usage
â”‚   âœ“ Free tier available
â”‚   âœ“ Works offline (no cloud dependency)
â”‚   âœ“ Simple YAML rule syntax
â”œâ”€ Limitations:
â”‚   âœ— Higher false-positive rate than CodeQL
â”‚   âœ— Less sophisticated data flow analysis
â”‚   âœ— Pattern-based (may miss complex vulnerabilities)
â”œâ”€ Use Cases:
â”‚   â€¢ Fast feedback in CI/CD
â”‚   â€¢ Custom security policies
â”‚   â€¢ Multi-language projects
â”‚   â€¢ Resource-constrained environments
â”‚   â€¢ Enforcing coding standards
â”œâ”€ Example Custom Rule:
â”‚   rules:
â”‚     - id: hardcoded-api-key
â”‚       pattern: |
â”‚         const API_KEY = "..."
â”‚       message: "Hardcoded API key detected"
â”‚       severity: ERROR
â”‚       languages: [javascript]
â”œâ”€ Example Findings:
â”‚   â€¢ "SQL query built from user input"
â”‚   â€¢ "Dangerous function eval() used"
â”‚   â€¢ "Hardcoded password in configuration"
â”‚   â€¢ "Missing input validation"
â””â”€ Status: ðŸ“‹ Alternative to CodeQL for faster scans

COMPARISON: CodeQL vs Semgrep
â”œâ”€ Speed:           CodeQL (slower) vs Semgrep (faster)
â”œâ”€ Accuracy:        CodeQL (higher) vs Semgrep (good)
â”œâ”€ False Positives: CodeQL (lower) vs Semgrep (higher)
â”œâ”€ Customization:   CodeQL (complex) vs Semgrep (easy)
â”œâ”€ Learning Curve:  CodeQL (steep) vs Semgrep (gentle)
â”œâ”€ Cost:            CodeQL (free for public) vs Semgrep (free tier)
â”œâ”€ GitHub Integration: CodeQL (native) vs Semgrep (supported)
â””â”€ Recommendation:  CodeQL for production, Semgrep for speed

Tool #7: SonarQube
â”œâ”€ Purpose: Comprehensive code quality and security analysis
â”œâ”€ Stage: SONAR (Manual gate)
â”œâ”€ Technology: SonarQube/SonarCloud
â”œâ”€ What it scans: Full codebase (frontend + backend)
â”œâ”€ Detects: Code smells, bugs, vulnerabilities, duplications, coverage gaps
â”œâ”€ Metrics: Technical debt, maintainability rating, security rating
â”œâ”€ Exit behavior: Manual review (quality gate)
â”œâ”€ Scan time: 5-10 minutes
â”œâ”€ Implementation: Separate stage after security-scan
â”œâ”€ Features:
â”‚   â€¢ Historical trend analysis
â”‚   â€¢ Pull request decoration
â”‚   â€¢ Custom quality gates
â”‚   â€¢ IDE integration
â””â”€ Status: ðŸ“‹ Planned for enhanced pipeline

CATEGORY 2: SECRET SCANNING
----------------------------
Purpose: Detect exposed credentials, API keys, tokens
When: Test stage (blocking) + Security-scan stage (warning)
Blocks: Yes (in TEST stage)

Tool #2: Secret Detection (Generic) - TruffleHog or detect-secrets
â”œâ”€ Purpose: Detect hardcoded secrets in code
â”œâ”€ Stage: TEST (Blocking)
â”œâ”€ Technology: TruffleHog (recommended) or detect-secrets (baseline approach)
â”œâ”€ What it scans: All source files, config files, env files
â”œâ”€ Detects: API keys, passwords, tokens, private keys, certificates
â”œâ”€ Exit behavior: BLOCKS on detection
â”œâ”€ Scan time: 1-2 minutes (TruffleHog), 30-60 seconds (detect-secrets)
â”œâ”€ Patterns: 700+ secret patterns (TruffleHog), 100+ (detect-secrets)
â””â”€ Status: ðŸ“‹ Planned for TEST stage

Tool #2a: TruffleHog (Recommended Secret Detection)
â”œâ”€ Purpose: Comprehensive secret scanning with entropy analysis
â”œâ”€ Developer: Truffle Security (trufflesecurity)
â”œâ”€ Category: Secret Detection / Credential Scanning
â”œâ”€ Stage: TEST (Blocking)
â”œâ”€ What it scans:
â”‚   â€¢ Git commit history (entire repository history)
â”‚   â€¢ Staged files (pre-commit scanning)
â”‚   â€¢ Working directory (uncommitted changes)
â”‚   â€¢ Docker images (container layers)
â”‚   â€¢ S3 buckets, filesystems (extended scanning)
â”œâ”€ How it works:
â”‚   â€¢ Entropy analysis (detects high-randomness strings)
â”‚   â€¢ Regex pattern matching (700+ built-in patterns)
â”‚   â€¢ Verification (validates if secrets are active)
â”‚   â€¢ Git history traversal (finds deleted secrets)
â”œâ”€ Detects:
â”‚   â€¢ AWS Access Keys (AKIA*, AWS Secret Access Keys)
â”‚   â€¢ GitHub Personal Access Tokens (ghp_, gho_, ghs_)
â”‚   â€¢ GitLab Tokens (glpat-)
â”‚   â€¢ Google Cloud API Keys
â”‚   â€¢ Azure Storage Keys
â”‚   â€¢ Private SSH Keys (RSA, ECDSA, Ed25519)
â”‚   â€¢ Database Connection Strings (MySQL, PostgreSQL, MongoDB)
â”‚   â€¢ API Keys (Stripe, SendGrid, Twilio, Slack, etc.)
â”‚   â€¢ OAuth Tokens
â”‚   â€¢ JWT Tokens (with sensitive data)
â”‚   â€¢ Encryption Keys (AES, DES)
â”‚   â€¢ Certificates (PEM, PKCS12)
â”‚   â€¢ Generic High-Entropy Strings (custom secrets)
â”œâ”€ Secret Verification:
â”‚   â€¢ Validates if detected secrets are ACTIVE
â”‚   â€¢ Tests AWS keys against AWS API
â”‚   â€¢ Tests GitHub tokens against GitHub API
â”‚   â€¢ Reduces false positives significantly
â”‚   â€¢ Provides confidence scores
â”œâ”€ Scan Modes:
â”‚   â€¢ git: Scan git repository history
â”‚   â€¢ filesystem: Scan directory without git
â”‚   â€¢ docker: Scan Docker images
â”‚   â€¢ github: Scan GitHub repositories remotely
â”œâ”€ Exit behavior: BLOCKS when verified secrets found
â”œâ”€ Scan time: 1-2 minutes (depends on git history size)
â”œâ”€ Output formats:
â”‚   â€¢ JSON (structured results)
â”‚   â€¢ Plain text (human-readable)
â”‚   â€¢ GitHub Actions annotations
â”œâ”€ GitHub Actions Integration:
â”‚   uses: trufflesecurity/trufflehog@main
â”‚   with:
â”‚     path: ./
â”‚     base: ${{ github.event.repository.default_branch }}
â”‚     head: HEAD
â”‚     extra_args: --only-verified
â”œâ”€ Advantages:
â”‚   âœ“ Entropy analysis (finds unknown secret types)
â”‚   âœ“ Secret verification (reduces false positives)
â”‚   âœ“ Scans entire git history (finds deleted secrets)
â”‚   âœ“ 700+ built-in detectors
â”‚   âœ“ Active development and updates
â”‚   âœ“ Docker image scanning capability
â”‚   âœ“ Free and open-source
â”‚   âœ“ Low false-positive rate (with verification)
â”œâ”€ Limitations:
â”‚   âœ— Slower on large repositories
â”‚   âœ— Verification requires network access
â”‚   âœ— May miss obfuscated secrets
â”œâ”€ Use Cases:
â”‚   â€¢ Pre-commit hooks (prevent secret commits)
â”‚   â€¢ CI/CD pipeline gates
â”‚   â€¢ Security audits of existing codebases
â”‚   â€¢ Compliance requirements (SOC2, PCI-DSS)
â”‚   â€¢ Finding leaked credentials in history
â”œâ”€ Example Findings:
â”‚   â€¢ "AWS Access Key AKIAIOSFODNN7EXAMPLE (VERIFIED)"
â”‚   â€¢ "GitHub Token ghp_xxxxxxxxxxxxxxxxxxxx (ACTIVE)"
â”‚   â€¢ "Private RSA key detected in commit abc123"
â”‚   â€¢ "High entropy string (possible secret): wJalrXUt..."
â”œâ”€ Configuration:
â”‚   â€¢ .trufflehogignore (exclude patterns)
â”‚   â€¢ Custom regex patterns
â”‚   â€¢ Verification toggles
â”‚   â€¢ Entropy thresholds
â””â”€ Status: ðŸ“‹ Recommended for TEST stage (blocking)

Tool #2b: detect-secrets (Baseline Approach)
â”œâ”€ Purpose: Baseline-driven secret detection with low false positives
â”œâ”€ Developer: Yelp
â”œâ”€ Category: Secret Detection / Credential Scanning
â”œâ”€ Stage: TEST (Blocking)
â”œâ”€ What it scans:
â”‚   â€¢ Source code files
â”‚   â€¢ Configuration files (JSON, YAML, XML)
â”‚   â€¢ Environment files (.env)
â”‚   â€¢ Documentation (Markdown, text)
â”œâ”€ How it works:
â”‚   â€¢ Creates baseline of known secrets
â”‚   â€¢ Scans for NEW secrets only
â”‚   â€¢ Plugin-based detection system
â”‚   â€¢ Heuristic-based filtering
â”œâ”€ Detects:
â”‚   â€¢ AWS keys (basic pattern matching)
â”‚   â€¢ Private keys (PEM format)
â”‚   â€¢ Basic authentication credentials
â”‚   â€¢ High entropy strings
â”‚   â€¢ Slack tokens
â”‚   â€¢ Stripe keys
â”‚   â€¢ Generic API key patterns
â”‚   â€¢ Hex-encoded secrets
â”‚   â€¢ Base64-encoded secrets
â”œâ”€ Baseline System:
â”‚   â€¢ .secrets.baseline (JSON file)
â”‚   â€¢ Stores known/approved secrets
â”‚   â€¢ Only alerts on NEW secrets
â”‚   â€¢ Reduces alert fatigue
â”‚   â€¢ Allows intentional secrets (test data)
â”œâ”€ Plugins:
â”‚   â€¢ AWSKeyDetector
â”‚   â€¢ PrivateKeyDetector
â”‚   â€¢ SlackDetector
â”‚   â€¢ StripeDetector
â”‚   â€¢ Base64HighEntropyString
â”‚   â€¢ HexHighEntropyString
â”‚   â€¢ KeywordDetector
â”œâ”€ Exit behavior: BLOCKS when new secrets found
â”œâ”€ Scan time: 30-60 seconds (faster than TruffleHog)
â”œâ”€ Output formats:
â”‚   â€¢ JSON baseline file
â”‚   â€¢ Text output (findings)
â”‚   â€¢ Exit codes (for CI/CD)
â”œâ”€ GitHub Actions Integration:
â”‚   - name: Scan for secrets
â”‚     run: |
â”‚       pip install detect-secrets
â”‚       detect-secrets scan --baseline .secrets.baseline
â”‚       detect-secrets audit .secrets.baseline
â”œâ”€ Advantages:
â”‚   âœ“ Very fast scanning
â”‚   âœ“ Baseline system (low false positives)
â”‚   âœ“ Pre-commit hook integration
â”‚   âœ“ Plugin architecture (extensible)
â”‚   âœ“ Allows intentional test secrets
â”‚   âœ“ Python-based (easy to integrate)
â”‚   âœ“ Free and open-source
â”œâ”€ Limitations:
â”‚   âœ— No secret verification (unlike TruffleHog)
â”‚   âœ— Doesn't scan git history by default
â”‚   âœ— Fewer built-in patterns than TruffleHog
â”‚   âœ— Requires baseline management
â”œâ”€ Use Cases:
â”‚   â€¢ Pre-commit hooks (fast feedback)
â”‚   â€¢ Projects with test secrets
â”‚   â€¢ Incremental secret scanning
â”‚   â€¢ Low false-positive requirements
â”‚   â€¢ Python-based CI/CD pipelines
â”œâ”€ Example Findings:
â”‚   â€¢ "Potential secret in config.json:15 (Base64HighEntropyString)"
â”‚   â€¢ "AWS key pattern detected in .env:3"
â”‚   â€¢ "Private key found in certs/key.pem"
â”œâ”€ Configuration:
â”‚   â€¢ .secrets.baseline (baseline file)
â”‚   â€¢ .pre-commit-config.yaml (pre-commit hook)
â”‚   â€¢ Plugin enable/disable
â”‚   â€¢ Entropy thresholds
â”œâ”€ Workflow:
â”‚   1. Initial scan: detect-secrets scan > .secrets.baseline
â”‚   2. Audit: detect-secrets audit .secrets.baseline
â”‚   3. CI check: detect-secrets scan --baseline .secrets.baseline
â”‚   4. Update baseline when adding approved secrets
â””â”€ Status: ðŸ“‹ Alternative for baseline-driven approach

COMPARISON: TruffleHog vs detect-secrets
â”œâ”€ Scope:            TruffleHog (git history) vs detect-secrets (current state)
â”œâ”€ Verification:     TruffleHog (yes) vs detect-secrets (no)
â”œâ”€ Speed:            TruffleHog (slower) vs detect-secrets (faster)
â”œâ”€ Patterns:         TruffleHog (700+) vs detect-secrets (100+)
â”œâ”€ False Positives:  TruffleHog (low with verification) vs detect-secrets (low with baseline)
â”œâ”€ Setup:            TruffleHog (simple) vs detect-secrets (baseline required)
â”œâ”€ Git History:      TruffleHog (full scan) vs detect-secrets (optional)
â”œâ”€ Maintenance:      TruffleHog (active) vs detect-secrets (stable)
â””â”€ Recommendation:   TruffleHog for comprehensive scanning, detect-secrets for speed

RECOMMENDED STRATEGY: Dual-Layer Secret Detection
â”œâ”€ Layer 1 (Pre-commit): detect-secrets
â”‚   â€¢ Fast feedback (30 seconds)
â”‚   â€¢ Prevents accidental commits
â”‚   â€¢ Developer-friendly
â”œâ”€ Layer 2 (CI/CD): TruffleHog
â”‚   â€¢ Comprehensive scan (git history)
â”‚   â€¢ Secret verification
â”‚   â€¢ Catches missed secrets
â””â”€ Result: Best of both worlds (speed + coverage)

Tool #6: Gitleaks
â”œâ”€ Purpose: Detect secrets in git history and code
â”œâ”€ Stage: SECURITY-SCAN (Warning)
â”œâ”€ Technology: Gitleaks v8+
â”œâ”€ What it scans: Git commits, staged files, entire history
â”œâ”€ Detects:
â”‚   â€¢ AWS keys, GCP keys, Azure credentials
â”‚   â€¢ GitHub tokens, GitLab tokens
â”‚   â€¢ Database credentials
â”‚   â€¢ Private keys (RSA, SSH)
â”‚   â€¢ API keys (Stripe, SendGrid, etc.)
â”œâ”€ Exit behavior: WARNING only (non-blocking)
â”œâ”€ Scan time: 1-3 minutes
â”œâ”€ Configuration: .gitleaks.toml (custom rules)
â”œâ”€ Output: JSON report with line numbers
â””â”€ Status: ðŸ“‹ Planned for SECURITY-SCAN stage

CATEGORY 3: SOFTWARE COMPOSITION ANALYSIS (SCA)
------------------------------------------------
Purpose: Scan dependencies for known vulnerabilities
When: Security-scan stage (parallel execution)
Blocks: No (warning mode)

Tool #4: npm audit
â”œâ”€ Purpose: Scan npm dependencies for CVEs
â”œâ”€ Stage: SECURITY-SCAN (Warning)
â”œâ”€ Technology: Built-in npm audit
â”œâ”€ What it scans: package.json, package-lock.json dependencies
â”œâ”€ Detects: Known vulnerabilities in npm packages (via GitHub Advisory DB)
â”œâ”€ Severity levels: Low, Moderate, High, Critical
â”œâ”€ Exit behavior: WARNING (non-blocking)
â”œâ”€ Scan time: 30-60 seconds
â”œâ”€ Command: npm audit --audit-level=moderate
â”œâ”€ Output:
â”‚   â€¢ Vulnerability count by severity
â”‚   â€¢ Affected packages and versions
â”‚   â€¢ Suggested fixes (npm audit fix)
â”œâ”€ Coverage: 2M+ vulnerabilities in npm registry
â””â”€ Status: ðŸ“‹ Planned for SECURITY-SCAN stage

Tool #7: RetireJS
â”œâ”€ Purpose: Detect outdated JavaScript libraries with known vulnerabilities
â”œâ”€ Stage: SECURITY-SCAN (Warning)
â”œâ”€ Technology: RetireJS scanner
â”œâ”€ What it scans: JavaScript libraries (frontend + bundled code)
â”œâ”€ Detects:
â”‚   â€¢ Outdated libraries (jQuery, Angular, React, etc.)
â”‚   â€¢ Known CVEs in JavaScript dependencies
â”‚   â€¢ Vulnerable versions with public exploits
â”œâ”€ Exit behavior: WARNING (non-blocking)
â”œâ”€ Scan time: 1-2 minutes
â”œâ”€ Database: Community-maintained vulnerability DB
â”œâ”€ Output: HTML/JSON report with CVE details
â”œâ”€ Use case: Complement npm audit (client-side focus)
â””â”€ Status: ðŸ“‹ Planned for SECURITY-SCAN stage

CATEGORY 4: CONTAINER SECURITY SCANNING
----------------------------------------
Purpose: Scan Docker images for vulnerabilities
When: Security-scan stage (after image build)
Blocks: No (warning mode)

Tool #5: Trivy
â”œâ”€ Purpose: Comprehensive container image security scanner
â”œâ”€ Stage: SECURITY-SCAN (Warning)
â”œâ”€ Technology: Aqua Security Trivy
â”œâ”€ What it scans:
â”‚   â€¢ OS packages (Alpine, Debian, Ubuntu, etc.)
â”‚   â€¢ Application dependencies (npm, pip, gem, etc.)
â”‚   â€¢ IaC misconfigurations (Dockerfile, K8s YAML)
â”‚   â€¢ Secrets in image layers
â”œâ”€ Detects:
â”‚   â€¢ CVEs in OS packages (apt, apk, yum)
â”‚   â€¢ Vulnerable dependencies in all layers
â”‚   â€¢ Dockerfile best practice violations
â”‚   â€¢ Exposed secrets in image history
â”œâ”€ Databases:
â”‚   â€¢ NVD (National Vulnerability Database)
â”‚   â€¢ GitHub Security Advisory
â”‚   â€¢ RHEL/Alpine/Debian security trackers
â”œâ”€ Exit behavior: WARNING (non-blocking in current config)
â”œâ”€ Scan time: 2-5 minutes
â”œâ”€ Command: trivy image --severity HIGH,CRITICAL juice-shop:latest
â”œâ”€ Output formats: JSON, SARIF, HTML table
â”œâ”€ Features:
â”‚   â€¢ Offline scanning (air-gapped environments)
â”‚   â€¢ SBOM generation (CycloneDX, SPDX)
â”‚   â€¢ CI/CD integration (GitHub Actions, GitLab CI)
â”‚   â€¢ Policy-as-code with Rego
â”œâ”€ Use case: Scan Docker images before pushing to registry
â””â”€ Status: ðŸ“‹ Planned for SECURITY-SCAN stage

Tool #6: OPA/Conftest (Dockerfile Policy Enforcement)
â”œâ”€ Purpose: Policy-as-Code for Dockerfile best practices validation
â”œâ”€ Stage: SECURITY-SCAN (Warning)
â”œâ”€ Technology: Open Policy Agent (OPA) + Conftest
â”œâ”€ What it validates:
â”‚   â€¢ Dockerfile best practices compliance
â”‚   â€¢ Security policy violations
â”‚   â€¢ Organizational standards enforcement
â”‚   â€¢ Image registry restrictions
â”‚   â€¢ Required security labels
â”œâ”€ Detects:
â”‚   â€¢ Running containers as root (USER not set)
â”‚   â€¢ Missing health checks (HEALTHCHECK)
â”‚   â€¢ Using latest tags (security risk)
â”‚   â€¢ Missing security labels
â”‚   â€¢ Exposed ports violating policy
â”‚   â€¢ Non-approved base images
â”‚   â€¢ Missing or incorrect metadata
â”‚   â€¢ Hardcoded secrets in Dockerfile
â”œâ”€ Language: Rego (OPA policy language)
â”œâ”€ Exit behavior: WARNING (non-blocking)
â”œâ”€ Scan time: 30-60 seconds
â”œâ”€ Commands:
â”‚   â€¢ conftest test Dockerfile
â”‚   â€¢ conftest test --policy ./policy Dockerfile
â”œâ”€ Output: Text report with policy violations
â”œâ”€ Configuration: policy/ directory with .rego files
â”œâ”€ Example policies:
â”‚   â€¢ Deny images without explicit user
â”‚   â€¢ Require approved base images only
â”‚   â€¢ Enforce minimal FROM layers
â”‚   â€¢ Mandate security labels
â”‚   â€¢ Block privileged operations
â”œâ”€ Use cases:
â”‚   â€¢ Enforce Dockerfile best practices
â”‚   â€¢ Validate security compliance before build
â”‚   â€¢ Organizational policy enforcement
â”‚   â€¢ Complement Trivy (policy vs vulnerabilities)
â”œâ”€ Integration: Pre-build validation, CI/CD gates
â””â”€ Status: ðŸ“‹ Planned for SECURITY-SCAN stage

CATEGORY 5: DYNAMIC APPLICATION SECURITY TESTING (DAST)
--------------------------------------------------------
Purpose: Test running application for runtime vulnerabilities
When: Staging deployments only (training/dev environment)
Blocks: No (warning mode)

Tool #10: OWASP ZAP (Staging)
â”œâ”€ Purpose: Dynamic security testing of deployed application
â”œâ”€ Stage: STAGING-SECURITY (Warning)
â”œâ”€ Technology: OWASP ZAP (Zed Attack Proxy) v2.14+
â”œâ”€ What it tests: Running web application (HTTP/HTTPS endpoints)
â”œâ”€ Scan modes:
â”‚   â€¢ Baseline scan (passive, 5-10 min) - Recommended for training
â”‚   â€¢ Full scan (active, 30-60 min) - Optional for deep testing
â”‚   â€¢ API scan (OpenAPI/Swagger specs)
â”œâ”€ Detects:
â”‚   â€¢ SQL injection vulnerabilities
â”‚   â€¢ Cross-Site Scripting (XSS)
â”‚   â€¢ CSRF (Cross-Site Request Forgery)
â”‚   â€¢ Security misconfigurations
â”‚   â€¢ Sensitive data exposure
â”‚   â€¢ Authentication/session issues
â”‚   â€¢ OWASP Top 10 vulnerabilities
â”œâ”€ Exit behavior: WARNING (non-blocking)
â”œâ”€ Scan time:
â”‚   â€¢ Baseline: 5-10 minutes
â”‚   â€¢ Full: 30-60 minutes (configurable)
â”œâ”€ Commands:
â”‚   â€¢ zap-baseline.py -t http://localhost:30080
â”‚   â€¢ zap-baseline.py -t http://staging.local
â”œâ”€ Output: HTML report, XML report, JSON results
â”œâ”€ Configuration: .zap/rules.tsv (custom risk levels)
â”œâ”€ Integration: Docker image (owasp/zap2docker-stable)
â”œâ”€ Use case: Validate application security in staging/dev environment
â”œâ”€ Training note: Scans training environment with intentional vulnerabilities
â””â”€ Status: ðŸ“‹ Planned for STAGING-SECURITY stage

Tool #11: Security Headers Check
â”œâ”€ Purpose: Validate HTTP security headers
â”œâ”€ Stage: STAGING-SECURITY (Warning)
â”œâ”€ Technology: securityheaders.com API or curl-based
â”œâ”€ What it checks:
â”‚   â€¢ Content-Security-Policy (CSP)
â”‚   â€¢ X-Frame-Options (clickjacking protection)
â”‚   â€¢ X-Content-Type-Options (MIME sniffing)
â”‚   â€¢ Strict-Transport-Security (HSTS)
â”‚   â€¢ X-XSS-Protection
â”‚   â€¢ Referrer-Policy
â”‚   â€¢ Permissions-Policy
â”œâ”€ Exit behavior: WARNING (non-blocking)
â”œâ”€ Scan time: 10-30 seconds
â”œâ”€ Command: curl -I http://localhost:30080
â”œâ”€ Scoring: A+ to F grade
â”œâ”€ Training note: Juice Shop intentionally has weak security headers
â””â”€ Status: ðŸ“‹ Planned for STAGING-SECURITY stage

CATEGORY 6: TESTING & VALIDATION
---------------------------------
Purpose: Ensure code quality and functionality
When: Test stage (after lint)
Blocks: No (warning mode in training)

Tool #3: Unit Tests
â”œâ”€ Purpose: Validate code functionality and catch regressions
â”œâ”€ Stage: TEST (Warning in training mode)
â”œâ”€ Technology:
â”‚   â€¢ Backend: Mocha + Chai
â”‚   â€¢ Frontend: Karma + Jasmine
â”‚   â€¢ API: Frisby + Jest
â”œâ”€ What it tests:
â”‚   â€¢ Server logic (routes, models, utilities)
â”‚   â€¢ Frontend components
â”‚   â€¢ API endpoints
â”œâ”€ Coverage: Code coverage reports via nyc/Istanbul
â”œâ”€ Exit behavior: WARNING (continue-on-error: true)
â”œâ”€ Reason for warning mode: Training environment, intentional vulnerabilities
â”œâ”€ Test counts:
â”‚   â€¢ Backend: 300+ tests
â”‚   â€¢ Frontend: 200+ tests
â”‚   â€¢ API: 100+ tests
â”œâ”€ Scan time: 5-10 minutes
â””â”€ Status: âœ… Currently implemented in simple-pipeline.yml

================================================================================
KUBERNETES SECURITY TOOLS (REFERENCE MATERIAL)
================================================================================

These tools are documented in DevSecOps reference material but not currently
planned for Juice Shop training. Included for completeness and future reference.

Tool #11: KubeSec
â”œâ”€ Purpose: Kubernetes manifest security scanning
â”œâ”€ Category: K8s Security
â”œâ”€ What it scans: K8s YAML manifests (deployments, pods, services)
â”œâ”€ Detects:
â”‚   â€¢ Pod Security Policy violations
â”‚   â€¢ Privilege escalation risks
â”‚   â€¢ Resource limits not set
â”‚   â€¢ Dangerous capabilities
â”‚   â€¢ Host network/PID/IPC usage
â”œâ”€ Scoring: Risk score (0-100)
â”œâ”€ Integration: CLI tool, Docker image, admission controller
â””â”€ Status: ðŸ”® Reference only (from DevSecOpsPractice repo)

Tool #12: KubeBench
â”œâ”€ Purpose: CIS Kubernetes Benchmark compliance checker
â”œâ”€ Category: K8s Security
â”œâ”€ What it tests: Kubernetes cluster configuration
â”œâ”€ Checks:
â”‚   â€¢ Master node security
â”‚   â€¢ Worker node security
â”‚   â€¢ etcd security
â”‚   â€¢ Control plane configuration
â”‚   â€¢ RBAC settings
â”œâ”€ Standards: CIS Kubernetes Benchmark v1.6+
â”œâ”€ Output: Pass/Fail report with remediation steps
â””â”€ Status: ðŸ”® Reference only

Tool #13: KubeScan
â”œâ”€ Purpose: Kubernetes risk assessment and RBAC analysis
â”œâ”€ Category: K8s Security
â”œâ”€ What it scans:
â”‚   â€¢ RBAC permissions
â”‚   â€¢ Service account privileges
â”‚   â€¢ Pod security contexts
â”‚   â€¢ Network policies
â”œâ”€ Output: Risk score per workload
â””â”€ Status: ðŸ”® Reference only

Tool #14: OPA/Conftest (K8s Manifest Validation)
â”œâ”€ Purpose: Policy-as-Code for Kubernetes manifest security
â”œâ”€ Category: Policy Enforcement (K8s focus)
â”œâ”€ What it validates:
â”‚   â€¢ Kubernetes security policies
â”‚   â€¢ K8s resource configurations
â”‚   â€¢ Custom organizational policies
â”œâ”€ Language: Rego (policy language)
â”œâ”€ Use cases:
â”‚   â€¢ Enforce K8s resource limits
â”‚   â€¢ Block privileged containers in K8s
â”‚   â€¢ Validate service account permissions
â”‚   â€¢ K8s network policy enforcement
â”œâ”€ Note: Also used for Dockerfile validation (see Tool #6)
â””â”€ Status: ðŸ”® Reference only (K8s use case)

Tool #15: Falco
â”œâ”€ Purpose: Runtime security monitoring for Kubernetes
â”œâ”€ Category: Runtime Security
â”œâ”€ What it monitors:
â”‚   â€¢ Abnormal system calls
â”‚   â€¢ Suspicious container behavior
â”‚   â€¢ Privilege escalation attempts
â”‚   â€¢ File integrity violations
â”œâ”€ Integration: DaemonSet, Helm chart
â”œâ”€ Alerting: Slack, PagerDuty, Syslog
â””â”€ Status: ðŸ”® Reference only

================================================================================
GITLAB AUTO-DEVOPS INTEGRATION
================================================================================

Tool #16: GitLab SAST
â”œâ”€ Purpose: Static Application Security Testing (GitLab built-in)
â”œâ”€ Stage: Auto-DevOps
â”œâ”€ Configuration: .gitlab-ci.yml
â”‚   include:
â”‚     - template: Auto-DevOps.gitlab-ci.yml
â”‚   variables:
â”‚     SAST_EXCLUDED_PATHS: "frontend/src/assets/private/**"
â”œâ”€ Scan targets: TypeScript, JavaScript, Node.js
â”œâ”€ Output: Security dashboard, vulnerability reports
â””â”€ Status: âœ… Configured (for GitLab CI usage)

Tool #17: GitLab DAST
â”œâ”€ Purpose: Dynamic Application Security Testing (GitLab built-in)
â”œâ”€ Stage: Auto-DevOps
â”œâ”€ Configuration: DAST_DISABLED: "true" (currently disabled)
â”œâ”€ Reason for disable: Training environment with intentional vulns
â””â”€ Status: âœ… Configured but disabled

================================================================================
PIPELINE STAGE BREAKDOWN
================================================================================

STAGE 1: SETUP/LINT
-------------------
â”œâ”€ npm install
â”œâ”€ npm run lint
â””â”€ Purpose: Code style and syntax validation

STAGE 2: TEST (Blocking Stage)
-------------------------------
â”œâ”€ Tool #1: SAST [BLOCK on HIGH/CRITICAL]
â”œâ”€ Tool #2: Secret Detection [BLOCK on detection]
â”œâ”€ Tool #3: Unit Tests [WARN in training, BLOCK in production]
â””â”€ Purpose: Early vulnerability detection (shift-left security)

STAGE 3: SECURITY-SCAN (Parallel Execution)
--------------------------------------------
â”œâ”€ Tool #4: npm audit [WARN]
â”œâ”€ Tool #5: Trivy container scan [WARN]
â”œâ”€ Tool #6: OPA/Conftest Dockerfile validation [WARN]
â”œâ”€ Tool #7: Gitleaks [WARN]
â”œâ”€ Tool #8: RetireJS [WARN]
â””â”€ Purpose: Comprehensive security scanning (non-blocking alerts)

STAGE 4: SONAR (Manual Gate)
-----------------------------
â”œâ”€ Tool #9: SonarQube [MANUAL REVIEW]
â””â”€ Purpose: Code quality gate and manual review checkpoint

STAGE 5: STAGING DEPLOY
------------------------
â”œâ”€ Build Docker image
â”œâ”€ Push to registry
â””â”€ Deploy to staging environment

STAGE 6: STAGING-SECURITY (Post-Deploy Validation)
---------------------------------------------------
â”œâ”€ Tool #10: OWASP ZAP baseline scan [WARN]
â”œâ”€ Tool #11: Security Headers check [WARN]
â””â”€ Purpose: Runtime security validation in staging/dev environment

NOTE: This training pipeline stops at staging. Production deployment is not
covered in this dev/training-focused guide.

================================================================================
TOOL SELECTION RATIONALE
================================================================================

WHY THESE TOOLS?
----------------

1. npm audit
   âœ“ Built-in to npm (no installation required)
   âœ“ Covers Node.js/JavaScript dependencies
   âœ“ Integrated with GitHub Advisory Database
   âœ“ Free and widely adopted

2. Trivy
   âœ“ Comprehensive scanner (OS + dependencies + IaC + secrets)
   âœ“ Fast scanning (2-5 minutes)
   âœ“ Multiple output formats (JSON, SARIF, HTML)
   âœ“ Active maintenance and frequent updates
   âœ“ Free and open-source

3. OPA/Conftest
   âœ“ Policy-as-Code for Dockerfile validation
   âœ“ Enforce organizational security standards
   âœ“ Flexible Rego policy language
   âœ“ Complements vulnerability scanners with policy checks
   âœ“ Free and open-source

4. Gitleaks
   âœ“ Purpose-built for git secret scanning
   âœ“ Scans entire git history
   âœ“ 600+ secret patterns
   âœ“ Low false-positive rate
   âœ“ Free and open-source

5. RetireJS
   âœ“ JavaScript-specific vulnerability scanner
   âœ“ Client-side library focus
   âœ“ Complements npm audit (different coverage)
   âœ“ Community-maintained vulnerability DB

6. OWASP ZAP
   âœ“ Industry standard for DAST
   âœ“ OWASP project (trusted, maintained)
   âœ“ Multiple scan modes (baseline, full, API)
   âœ“ Excellent CI/CD integration
   âœ“ Free and open-source

7. SonarQube
   âœ“ Comprehensive code quality + security
   âœ“ Historical trend analysis
   âœ“ Pull request decoration
   âœ“ IDE integration
   âœ“ Free community edition

================================================================================
BLOCKING VS WARNING STRATEGY
================================================================================

BLOCKING (Pipeline Fails) ðŸ”´
---------------------------
Stage: TEST
Tools:
  â€¢ SAST (HIGH/CRITICAL findings)
  â€¢ Secret Detection (any secrets found)
Rationale:
  âœ“ Critical vulnerabilities caught early
  âœ“ Prevent secrets from being committed
  âœ“ Left-shift security (fix before merge)

WARNING (Pipeline Continues) âš ï¸
-------------------------------
Stage: SECURITY-SCAN, STAGING-SECURITY
Tools:
  â€¢ npm audit
  â€¢ Trivy
  â€¢ OPA/Conftest
  â€¢ Gitleaks
  â€¢ RetireJS
  â€¢ OWASP ZAP
  â€¢ Security Headers
Rationale:
  âœ“ Training environment (intentionally vulnerable app)
  âœ“ Avoid false-positive pipeline failures
  âœ“ Generate alerts for review
  âœ“ Non-blocking visibility into security posture
  âœ“ Allows trainees to see full pipeline execution
  âœ“ Educational focus - learn from warnings without blocking

================================================================================
IMPLEMENTATION STATUS
================================================================================

CURRENTLY IMPLEMENTED (simple-pipeline.yml):
âœ… Stage 1: Lint (npm run lint)
âœ… Stage 2: Test (npm test with continue-on-error)
âœ… Stage 3: Build (Docker image build)
âœ… Stage 4: Push (Docker Hub push)
âœ… Stage 5: Deploy (Kubernetes deployment)

PLANNED FOR ENHANCED PIPELINE (Dev/Training Focus):
ðŸ“‹ SAST in TEST stage (CodeQL or Semgrep)
ðŸ“‹ Secret Detection in TEST stage
ðŸ“‹ npm audit in SECURITY-SCAN stage
ðŸ“‹ Trivy in SECURITY-SCAN stage
ðŸ“‹ OPA/Conftest in SECURITY-SCAN stage
ðŸ“‹ Gitleaks in SECURITY-SCAN stage
ðŸ“‹ RetireJS in SECURITY-SCAN stage
ðŸ“‹ SonarQube in SONAR stage
ðŸ“‹ OWASP ZAP in STAGING-SECURITY stage
ðŸ“‹ Security Headers check in STAGING-SECURITY stage

REFERENCE ONLY (DevSecOps material):
ðŸ”® KubeSec (K8s manifest scanning)
ðŸ”® KubeBench (CIS benchmark compliance)
ðŸ”® KubeScan (RBAC risk assessment)
ðŸ”® OPA/Conftest for K8s (Policy-as-Code for K8s manifests)
ðŸ”® Falco (Runtime security monitoring)

================================================================================
SECURITY SCAN TIMELINE
================================================================================

Total Pipeline Execution Time (Estimated):
-------------------------------------------

Simple Pipeline (Current):
â”œâ”€ Lint: 30-60 seconds
â”œâ”€ Test: 5-10 minutes
â”œâ”€ Build: 3-5 minutes
â”œâ”€ Push: 2-4 minutes
â”œâ”€ Deploy: 2-3 minutes
â””â”€ TOTAL: ~15-25 minutes

Enhanced Pipeline (Planned):
â”œâ”€ Lint: 30-60 seconds
â”œâ”€ TEST Stage (Sequential):
â”‚   â”œâ”€ SAST: 3-8 minutes
â”‚   â”œâ”€ Secret Detection: 1-2 minutes
â”‚   â””â”€ Unit Tests: 5-10 minutes
â”‚   â””â”€ Subtotal: 9-20 minutes
â”œâ”€ Build: 3-5 minutes
â”œâ”€ SECURITY-SCAN Stage (Parallel):
â”‚   â”œâ”€ npm audit: 30-60 seconds
â”‚   â”œâ”€ Trivy: 2-5 minutes
â”‚   â”œâ”€ OPA/Conftest: 30-60 seconds
â”‚   â”œâ”€ Gitleaks: 1-3 minutes
â”‚   â””â”€ RetireJS: 1-2 minutes
â”‚   â””â”€ Subtotal: 5-11 minutes (parallel execution, longest tool determines duration)
â”œâ”€ SonarQube: 5-10 minutes
â”œâ”€ Staging Deploy: 2-3 minutes
â”œâ”€ STAGING-SECURITY:
â”‚   â”œâ”€ OWASP ZAP Baseline: 5-10 minutes
â”‚   â””â”€ Security Headers: 10-30 seconds
â”‚   â””â”€ Subtotal: 5-11 minutes
â””â”€ TOTAL: ~35-60 minutes (with all security stages, dev/training focused)

Optimization Strategies:
â”œâ”€ Parallel execution in SECURITY-SCAN stage (saves 10-15 minutes)
â”œâ”€ Cache dependencies (saves 2-5 minutes per run)
â”œâ”€ Incremental SAST scans (saves 3-5 minutes)
â”œâ”€ Skip STAGING-SECURITY on feature branches (saves 5-10 minutes)
â””â”€ Optimized Trivy scanning with --skip-dirs (saves 1-2 minutes)

================================================================================
USEFUL COMMANDS
================================================================================

MANUAL TOOL EXECUTION (For Testing):
-------------------------------------

# npm audit
npm audit --audit-level=moderate
npm audit fix  # Auto-fix vulnerabilities

# Trivy container scan
docker pull aquasec/trivy:latest
trivy image juice-shop:latest --severity HIGH,CRITICAL
trivy image juice-shop:latest --format json --output trivy-report.json

# OPA/Conftest Dockerfile validation
docker pull openpolicyagent/conftest:latest
conftest test Dockerfile
conftest test --policy ./policy Dockerfile
# Example: Create policy file (policy/dockerfile.rego):
# package main
# deny[msg] {
#   input[i].Cmd == "from"
#   val := split(input[i].Value[0], ":")
#   val[1] == "latest"
#   msg = "Do not use 'latest' tag for base image"
# }

# Gitleaks
docker run --rm -v $(pwd):/repo zricethezav/gitleaks:latest detect --source /repo
gitleaks detect --verbose --log-level debug

# RetireJS
docker run --rm -v $(pwd):/src retirejs/retire.js:latest --path /src
npm install -g retire && retire --path .

# OWASP ZAP baseline scan
docker run --rm -v $(pwd):/zap/wrk:rw owasp/zap2docker-stable:latest \
  zap-baseline.py -t http://localhost:3000 -r zap-report.html

# Security Headers check
curl -I http://localhost:3000 | grep -E "Content-Security-Policy|X-Frame-Options|Strict-Transport-Security"

# SonarQube (requires server setup)
npm install -g sonarqube-scanner
sonar-scanner -Dsonar.projectKey=juice-shop -Dsonar.sources=.

================================================================================
CONFIGURATION FILES
================================================================================

LOCATIONS:
----------
â”œâ”€ .github/workflows/simple-pipeline.yml       (Current pipeline)
â”œâ”€ .github/workflows/enhanced-pipeline.yml     (Planned - with security tools)
â”œâ”€ .gitlab-ci.yml                              (GitLab Auto-DevOps config)
â”œâ”€ .zap/rules.tsv                              (OWASP ZAP custom rules)
â”œâ”€ .gitleaks.toml                              (Gitleaks configuration - TBD)
â”œâ”€ policy/dockerfile.rego                      (OPA/Conftest Dockerfile policies - TBD)
â”œâ”€ policy/kubernetes.rego                      (OPA/Conftest K8s policies - TBD)
â”œâ”€ sonar-project.properties                    (SonarQube config - TBD)
â””â”€ trivy.yaml                                  (Trivy policy config - TBD)

SAMPLE CONFIGURATIONS:
----------------------

# .gitleaks.toml (example)
[extend]
useDefault = true

[[rules]]
description = "Custom API Key Pattern"
regex = '''(?i)(api[_-]?key|apikey)['"\s:=]+([a-zA-Z0-9]{32,})'''
tags = ["key", "API"]

# policy/dockerfile.rego (OPA/Conftest example)
package main

deny[msg] {
  input[i].Cmd == "from"
  val := split(input[i].Value[0], ":")
  contains(val[1], "latest")
  msg = sprintf("Line %d: Do not use 'latest' tag for base images", [i])
}

deny[msg] {
  input[i].Cmd == "user"
  msg == ""
  msg = "No USER directive found - container will run as root"
}

warn[msg] {
  input[i].Cmd == "healthcheck"
  msg == ""
  msg = "No HEALTHCHECK directive found - consider adding one"
}

# trivy.yaml (example)
vulnerability:
  type:
    - os
    - library
  severities:
    - CRITICAL
    - HIGH
    - MEDIUM

# sonar-project.properties (example)
sonar.projectKey=juice-shop
sonar.sources=.
sonar.exclusions=frontend/node_modules/**,node_modules/**,build/**
sonar.javascript.lcov.reportPaths=coverage/lcov.info

================================================================================
TRAINING NOTES
================================================================================

PEDAGOGICAL APPROACH:
---------------------

Part 3: Simple Pipeline First (Current State)
â”œâ”€ Focus: Get it working (GREEN pipeline)
â”œâ”€ Stages: Lint â†’ Test â†’ Build â†’ Push â†’ Deploy
â”œâ”€ No security tools yet
â””â”€ Purpose: Establish baseline before complexity

Part 7: Enhanced Pipeline with Security (Planned)
â”œâ”€ Focus: Layer security incrementally
â”œâ”€ Start: Add SAST + Secret Detection (blocking)
â”œâ”€ Then: Add parallel security scans (warning mode)
â”œâ”€ Finally: Add DAST + monitoring (staging validation)
â””â”€ Purpose: Real-world evolution (not big-bang approach, dev/training focused)

TRAINING VALUE:
---------------
âœ“ See pipeline evolution: Simple â†’ Secure â†’ Mature
âœ“ Understand tool purpose and placement
âœ“ Learn blocking vs warning strategies
âœ“ Practice fixing security findings
âœ“ Compare scan results across tools
âœ“ Experience DevSecOps workflow

INTENTIONAL VULNERABILITIES:
----------------------------
âš ï¸  IMPORTANT: Juice Shop is intentionally vulnerable
â”œâ”€ Tools WILL find real vulnerabilities
â”œâ”€ This is EXPECTED and DESIRED for training
â”œâ”€ Tools configured in WARNING mode to allow full pipeline execution
â”œâ”€ Trainees learn to:
â”‚   â”œâ”€ Interpret security scan results
â”‚   â”œâ”€ Prioritize findings by severity
â”‚   â”œâ”€ Fix vulnerabilities using Claude Code
â”‚   â””â”€ Verify fixes with re-scans
â””â”€ Do NOT suggest "fixing" vulnerabilities unless explicitly requested

================================================================================
REFERENCES
================================================================================

DOCUMENTATION:
--------------
â”œâ”€ docs/DEVSECOPS_TRAINING_WITH_JUICE_SHOP.txt (Training overview)
â”œâ”€ docs/devsecops-practice-summary.txt         (DevSecOps reference material)
â”œâ”€ docs/ChangeLog.txt                          (Implementation history)
â”œâ”€ docs/Summary/simple-pipeline-setup-summary.txt (Simple pipeline session)
â””â”€ docs/Summary/DevSecOps-Summary.txt          (DevSecOps tools reference)

PIPELINE IMPLEMENTATIONS:
-------------------------
â”œâ”€ .github/workflows/simple-pipeline.yml       (Current: 5-stage simple pipeline)
â”œâ”€ .gitlab-ci.yml                              (GitLab Auto-DevOps with SAST)
â””â”€ .github/workflows-archive/zap_scan.yml      (Archived: OWASP ZAP example)

TOOL DOCUMENTATION:
-------------------
â”œâ”€ npm audit: https://docs.npmjs.com/cli/v10/commands/npm-audit
â”œâ”€ Trivy: https://trivy.dev/
â”œâ”€ Gitleaks: https://github.com/gitleaks/gitleaks
â”œâ”€ RetireJS: https://retirejs.github.io/retire.js/
â”œâ”€ OWASP ZAP: https://www.zaproxy.org/docs/
â”œâ”€ SonarQube: https://docs.sonarqube.org/
â”œâ”€ KubeSec: https://kubesec.io/
â”œâ”€ Falco: https://falco.org/docs/
â””â”€ DevSecOpsPractice: /Users/rupeshpanwar/Documents/DevSecOpsPractice-main/

DEVSECOPS LEARNING PATH:
-------------------------
Reference Repository: DevSecOpsPractice-main/DevSecOps/
â”œâ”€ Module 10: DevSecOps-SAST-SonarQube.md
â”œâ”€ Module 11: DevSecOps-DependencyCheck-Vulnerabilites.md
â”œâ”€ Module 12: DevSecOps-Trivy-Vuln-Scanner.md
â”œâ”€ Module 14: DevSecOps-KubeSec.md
â”œâ”€ Module 19: DevSecOps-Dyna-App-Sec-Testing.md (OWASP ZAP)
â””â”€ Module 25: DevSecOps-Falco-Runtime-Security-Helm.md

================================================================================
NEXT STEPS
================================================================================

FOR TRAINEES:
-------------
1. âœ… Understand simple pipeline (Part 3 completed)
2. ðŸ“‹ Review security tool inventory (this document)
3. ðŸ“‹ Prepare for Part 7: Enhanced Pipeline with Security Scanning
4. ðŸ“‹ Study tool purposes and pipeline placement
5. ðŸ“‹ Learn to interpret security scan results

FOR IMPLEMENTATION:
-------------------
1. Create .github/workflows/enhanced-pipeline.yml
2. Add SAST stage (CodeQL or Semgrep)
3. Add Secret Detection stage (TruffleHog or detect-secrets)
4. Add parallel security-scan stage (npm audit, Trivy, OPA/Conftest, Gitleaks, RetireJS)
5. Create OPA/Conftest policy files (policy/dockerfile.rego)
6. Add SonarQube integration (optional: SonarCloud for cloud-based)
7. Add DAST stage (OWASP ZAP baseline scan)
8. Configure warning/blocking thresholds
9. Create /security-scan-setup slash command
10. Test full pipeline execution
11. Document findings and create training materials

FOR ADVANCED TRAINING:
----------------------
1. Integrate Kubernetes security tools (KubeSec, KubeBench)
2. Add runtime monitoring (Falco)
3. Implement Policy-as-Code (OPA/Conftest)
4. Set up security monitoring dashboard
5. Configure automated remediation (Dependabot, Renovate)
6. Implement security incident response workflow

================================================================================
END OF DOCUMENT
================================================================================

Last Updated: 2025-11-25
Document Owner: DevSecOps Training Team
Version: 1.4 (Added Comprehensive SAST and Secret Detection Tool Details)
Status: Living Document (will be updated as pipeline evolves)

CHANGELOG:
----------
v1.4 (2025-11-25):
  - Added comprehensive CodeQL documentation (Tool #1a)
    â€¢ Detailed semantic code analysis capabilities
    â€¢ 12+ vulnerability types detected (SQL injection, XSS, etc.)
    â€¢ GitHub Actions integration examples
    â€¢ Advantages, limitations, and use cases
  - Added comprehensive Semgrep documentation (Tool #1b)
    â€¢ Pattern-based SAST alternative
    â€¢ Custom rule creation examples
    â€¢ Performance comparison with CodeQL
    â€¢ YAML-based rule syntax
  - Added CodeQL vs Semgrep comparison matrix
    â€¢ Speed, accuracy, false positives, customization
    â€¢ Recommendation: CodeQL for production, Semgrep for speed
  - Added comprehensive TruffleHog documentation (Tool #2a)
    â€¢ Entropy analysis and secret verification
    â€¢ 700+ built-in secret detectors
    â€¢ Git history scanning capabilities
    â€¢ Active secret verification (AWS, GitHub, etc.)
  - Added comprehensive detect-secrets documentation (Tool #2b)
    â€¢ Baseline-driven approach
    â€¢ Plugin architecture details
    â€¢ Pre-commit hook integration
    â€¢ Workflow examples
  - Added TruffleHog vs detect-secrets comparison matrix
    â€¢ Scope, verification, speed, patterns
    â€¢ Recommended dual-layer strategy
  - Updated Tool #1 and Tool #2 summaries with specific implementations
  - Total documentation: 400+ new lines of detailed tool information
  - Purpose: Address TODO items in enhanced-pipeline.yml (lines 50, 78)

v1.3 (2025-11-25):
  - Added K8S-SECURITY stage to horizontal pipeline flow diagram
  - Now shows all 15 tools (11 main + 4 K8s reference) in single flow diagram
  - K8s tools displayed: #12 KubeSec, #13 KubeBench, #14 KubeScan, #15 Falco
  - Added ðŸ”® indicator for reference/optional K8s security tools
  - Updated TL;DR to mention 5 pipeline stages (including K8s)
  - Updated STAGE DETAILS to include K8S-SECURITY description
  - Updated LEGEND to explain [REF] and ðŸ”® symbols
  - Pipeline now visually complete with all documented tools

v1.2 (2025-11-25):
  - Removed all production deployment references (focus on dev/training)
  - Removed Tool #11 OWASP ZAP (Prod) from main inventory
  - Removed STAGE 7 & 8 (PROD DEPLOY and PROD-SECURITY) from pipeline
  - Updated pipeline flow diagram to end at STAGING-SECURITY
  - Updated tool count from 12 to 11 main tools
  - Updated OWASP ZAP commands to use localhost:30080 (training environment)
  - Updated Security Headers check to use training environment URL
  - Removed production behavior notes from Unit Tests
  - Added training notes to DAST tools emphasizing dev/training focus
  - Updated total execution time (~35-60 minutes vs ~40-75 minutes)
  - Emphasized dev/training environment throughout document

v1.1 (2025-11-25):
  - Added OPA/Conftest as Tool #6 in main security tools inventory
  - Updated pipeline flow diagram to include OPA/Conftest in SECURITY-SCAN stage
  - Added detailed description of OPA/Conftest for Dockerfile validation
  - Updated tool numbers for Security Headers (now #11) and all subsequent tools
  - Added sample OPA/Conftest policy configuration (policy/dockerfile.rego)
  - Updated implementation roadmap and commands section
  - Total tools count: 11 main tools + 4 K8s reference tools

v1.0 (2025-11-24):
  - Initial comprehensive security tools documentation
  - Documented 10 main security tools + 5 K8s reference tools
  - Created pipeline flow diagram and detailed tool descriptions

